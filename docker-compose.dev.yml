# 开发环境配置 - 挂载代码目录以便实时修改
services:
  wechat-server:
    build: .
    container_name: wechat_message_server
    restart: unless-stopped
    ports:
      - "${WECHAT_SERVER_PORT:-8000}:8000"
    volumes:
      - ./data:/app/data  # 持久化数据（SQLite 数据库）
      - .:/app  # 开发模式：挂载代码目录
      # 使用匿名卷保护 Python 包，避免被本地目录覆盖
      - /usr/local/lib/python3.12/site-packages
    environment:
      - WECHAT_APP_ID=${WECHAT_APP_ID:-}
      - WECHAT_APP_SECRET=${WECHAT_APP_SECRET:-}
      - WECHAT_TOKEN=${WECHAT_TOKEN:-}
      - WECHAT_ENCODING_AES_KEY=${WECHAT_ENCODING_AES_KEY:-}
      - WECHAT_SERVER_PORT=8000
      - WECHAT_SERVER_HOST=0.0.0.0
      - WECHAT_API_PROXY=${WECHAT_API_PROXY:-api.weixin.qq.com}
      - WECHAT_API_TIMEOUT=${WECHAT_API_TIMEOUT:-30}
    command: python api/wechat_server.py
    networks:
      - wechat_network

networks:
  wechat_network:
    driver: bridge

